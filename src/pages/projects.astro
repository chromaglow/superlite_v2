---
import Layout from "../layouts/Layout.astro";
import { projectsPageContent } from "../config";
import ProjectCard from "../components/ProjectCard.astro";
import { getCollection } from "astro:content";

const posts = await getCollection("posts");
---

<Layout seo={projectsPageContent.seo}>
  <section class="mt-10 max-w-2xl mx-auto px-6">
    <h1 class="font-bold text-3xl mb-1">Projects</h1>
    <p class="opacity-60 mb-10">{projectsPageContent.subtitle}</p>
    <div class="grid grid-cols-1 group">
      {
        // MERGED: Static projects from config + Dynamic projects from Content Collection
        [
          ...projectsPageContent.projects,
          ...posts
            .filter(
              (p) =>
                p.data.type === "project" || p.data.tags?.includes("project"),
            )
            .map((p) => ({
              title: p.data.title,
              description: p.data.description,
              image: p.data.image.url.src,
              year: p.data.pubDate.getFullYear().toString(),
              url: `${import.meta.env.BASE_URL}/blog/${p.id}`, // Link to the post detail page
            })),
        ].map((project) => <ProjectCard {...project} />)
      }
    </div>
  </section>
</Layout>
